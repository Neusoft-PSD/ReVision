function rects = fitrectangles(edgelim, goodrect_err)

    if ~exist('goodrect_err', 'var')
        if ~exist('GOOD_BAR_THRESH')
            thresholds();
            goodrect_err = GOOD_BAR_THRESH;
        end
    end

    rects = {};
    while true
        fprintf(2, 'RANSAC-ing...\n');
        [rect, rect_inliers, total_error] = rect_RANSAC(edgelim);

        if isempty(fieldnames(rect))
            return;
        end

        if total_error > goodrect_err
            return;
        end

        fprintf(2, 'adding to rectangle list...\n');
        rect_inliers = floor(rect_inliers);
        rects{end+1} = rect.rect;

        edgelim(sub2ind(size(edgelim), rect_inliers(:,2), rect_inliers(:,1))) = 0;          
    end
end